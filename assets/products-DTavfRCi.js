import{g as pe,p as Ve,r as xe,aC as be,v as f,aD as Re,E as ye,aE as he,aF as J,S as t,U as q,aG as ke,H as Ie,aH as we,aI as ue,c as O,s as Ue,m as Me,aJ as Be,e as De,o as Ne,w as B,b as He,aK as ie,R as w,Y as Q,aL as Te,af as de,aM as _e,aN as $e,as as ze,a as ee,aO as Ee,aP as qe,Q as j,d as Ge,aQ as Oe,ai as je,aR as Le,a0 as We,_ as Qe,a1 as ce,$ as s,an as L,ak as Je,al as Ke,ah as Ye,V as Xe,aB as ae,aS as Ze,am as W,aT as ea,a2 as r,aA as aa,aw as ta,ao as me,ay as la,az as oa,aU as na}from"./index-C-Wof5fh.js";import{c as ra,a as sa,b as te,d as ua,u as ia,e as E,V as da}from"./index.esm-CFIa1j0f.js";import{s as le}from"./product-8O1O2EAa.js";import{V as ca,a as ve,b as fe}from"./route-block-CDH56o19.js";import{V as ma}from"./VDivider-DMSXzlXu.js";import{V as va}from"./VDataTable-ByRRS1ag.js";import{V as fa}from"./VToolbar-D1bM2oW_.js";import{V as ga}from"./VContainer-Dvv4KtVd.js";import{v as ge,w as pa,s as Va}from"./VPagination-Bn5wrU0a.js";import"./VList-CXA49yes.js";import"./ssrBoot-DksyFfg0.js";const xa=Ve({...we(),...Ie(pa(),["inline"])},"VCheckbox"),ba=pe()({name:"VCheckbox",inheritAttrs:!1,props:xa(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,h){let{attrs:C,slots:V}=h;const c=xe(e,"modelValue"),{isFocused:u,focus:x,blur:i}=be(e),S=f(),D=Re();return ye(()=>{const[N,_]=he(C),b=J.filterProps(e),g=ge.filterProps(e);return t(J,q({ref:S,class:["v-checkbox",e.class]},N,b,{modelValue:c.value,"onUpdate:modelValue":p=>c.value=p,id:e.id||`checkbox-${D}`,focused:u.value,style:e.style}),{...V,default:p=>{let{id:m,messagesId:y,isDisabled:P,isReadonly:v,isValid:H}=p;return t(ge,q(g,{id:m.value,"aria-describedby":y.value,disabled:P.value,readonly:v.value},_,{error:H.value===!1,modelValue:c.value,"onUpdate:modelValue":A=>c.value=A,onFocus:x,onBlur:i}),V)}})}),ke({},S)}}),ya=Ve({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxHeight:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...qe(),...we(),...Ee()},"VTextarea"),ha=pe()({name:"VTextarea",directives:{vIntersect:ue},inheritAttrs:!1,props:ya(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,"update:rows":e=>!0},setup(e,h){let{attrs:C,emit:V,slots:c}=h;const u=xe(e,"modelValue"),{isFocused:x,focus:i,blur:S}=be(e),{onIntersect:D}=_e(e),N=O(()=>typeof e.counterValue=="function"?e.counterValue(u.value):(u.value||"").toString().length),_=O(()=>{if(C.maxlength)return C.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter}),b=f(),g=f(),p=Ue(""),m=f(),y=f(0),{platform:P}=Me(),v=Be(e),H=O(()=>e.persistentPlaceholder||x.value||e.active);function A(){v.isSuppressing.value&&v.update(),m.value!==document.activeElement&&m.value?.focus(),x.value||i()}function o(n){A(),V("click:control",n)}function a(n){V("mousedown:control",n)}function $(n){n.stopPropagation(),A(),j(()=>{u.value="",Oe(e["onClick:clear"],n)})}function l(n){const d=n.target;if(!e.modelModifiers?.trim){u.value=d.value;return}const k=d.value,T=d.selectionStart,U=d.selectionEnd;u.value=k,j(()=>{let M=0;k.trimStart().length===d.value.length&&(M=k.length-d.value.length),T!=null&&(d.selectionStart=T-M),U!=null&&(d.selectionEnd=U-M)})}const R=f(),z=f(Number(e.rows)),K=O(()=>["plain","underlined"].includes(e.variant));De(()=>{e.autoGrow||(z.value=Number(e.rows))});function I(){j(()=>{if(!m.value)return;if(P.value.firefox){y.value=12;return}const{offsetWidth:n,clientWidth:d}=m.value;y.value=Math.max(0,n-d)}),e.autoGrow&&j(()=>{if(!R.value||!g.value)return;const n=getComputedStyle(R.value),d=getComputedStyle(g.value.$el),k=parseFloat(n.getPropertyValue("--v-field-padding-top"))+parseFloat(n.getPropertyValue("--v-input-padding-top"))+parseFloat(n.getPropertyValue("--v-field-padding-bottom")),T=R.value.scrollHeight,U=parseFloat(n.lineHeight),M=Math.max(parseFloat(e.rows)*U+k,parseFloat(d.getPropertyValue("--v-input-control-height"))),Y=e.maxHeight?parseFloat(e.maxHeight):parseFloat(e.maxRows)*U+k||1/0,F=Ge(T??0,M,Y);z.value=Math.floor((F-k)/U),p.value=ee(F)})}Ne(I),B(u,I),B(()=>e.rows,I),B(()=>e.maxHeight,I),B(()=>e.maxRows,I),B(()=>e.density,I),B(z,n=>{V("update:rows",n)});let G;return B(R,n=>{n?(G=new ResizeObserver(I),G.observe(R.value)):G?.disconnect()}),He(()=>{G?.disconnect()}),ye(()=>{const n=!!(c.counter||e.counter||e.counterValue),d=!!(n||c.details),[k,T]=he(C),{modelValue:U,...M}=J.filterProps(e),Y={...ie.filterProps(e),"onClick:clear":$};return t(J,q({ref:b,modelValue:u.value,"onUpdate:modelValue":F=>u.value=F,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":K.value},e.class],style:[{"--v-textarea-max-height":e.maxHeight?ee(e.maxHeight):void 0,"--v-textarea-scroll-bar-width":ee(y.value)},e.style]},k,M,{centerAffix:z.value===1&&!K.value,focused:x.value}),{...c,default:F=>{let{id:X,isDisabled:oe,isDirty:ne,isReadonly:Ce,isValid:Pe,hasDetails:Fe}=F;return t(ie,q({ref:g,style:{"--v-textarea-control-height":p.value},onClick:o,onMousedown:a,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Y,{id:X.value,active:H.value||ne.value,labelId:`${X.value}-label`,centerAffix:z.value===1&&!K.value,dirty:ne.value||e.dirty,disabled:oe.value,focused:x.value,details:Fe.value,error:Pe.value===!1}),{...c,default:Se=>{let{props:{class:re,...se},controlRef:Ae}=Se;return w(Q,null,[e.prefix&&w("span",{class:"v-text-field__prefix"},[e.prefix]),de(w("textarea",q({ref:Z=>m.value=Ae.value=Z,class:re,value:u.value,onInput:l,autofocus:e.autofocus,readonly:Ce.value,disabled:oe.value,placeholder:e.placeholder,rows:e.rows,name:v.fieldName.value,autocomplete:v.fieldAutocomplete.value,onFocus:A,onBlur:S,"aria-labelledby":`${X.value}-label`},se,T),null),[[ue,{handler:D},null,{once:!0}]]),e.autoGrow&&de(w("textarea",{class:ze([re,"v-textarea__sizer"]),id:`${se.id}-sizer`,"onUpdate:modelValue":Z=>u.value=Z,ref:R,readonly:!0,"aria-hidden":"true"},null),[[$e,u.value]]),e.suffix&&w("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:d?F=>w(Q,null,[c.details?.(F),n&&w(Q,null,[w("span",null,null),t(Te,{active:e.persistentCounter||x.value,value:N.value,max:_.value,disabled:e.disabled},c.counter)])]):void 0})}),ke({},b,g,m)}}),ka={__name:"products",setup(e){const h=je(),C=f([]),V=f(""),c=[{title:"ID",key:"_id"},{title:"圖片",key:"imageUrl",sortable:!1},{title:"名稱",key:"name"},{title:"分類",key:"category"},{title:"價格",key:"price"},{title:"說明",key:"description"},{title:"上架",key:"sell"},{title:"建立日期",key:"createdAt",value:o=>new Date(o.createdAt).toLocaleString()},{title:"修改日期",key:"updatedAt",value:o=>new Date(o.createdAt).toLocaleString()},{title:"操作",key:"action",sortable:!1}],u=async()=>{try{const{data:o}=await le.getAll();C.value=o.result}catch{h({text:"發生錯誤",snackbarProps:{color:"red"}})}};u();const x=Le("fileAgent"),i=f({open:!1,id:""}),S=o=>{o&&(i.value.id=o._id,g.value.value=o.name,p.value.value=o.price,m.value.value=o.description,y.value.value=o.category,P.value.value=o.sell),i.value.open=!0},D=()=>{i.value.open=!1,i.value.id="",b.resetForm(),x.value.deleteFileRecord()},N=["手機","電腦","平板","玩具","食品","衣服","遊戲","書籍","其他"],_=ra({name:te().required("請輸入商品名稱").min(1,"商品名稱最少 1 個字").max(100,"商品名稱最多 100 個字"),price:ua().typeError("請輸入商品價格").required("請輸入商品價格").min(0,"商品價格最少 0 元"),description:te().max(1e3,"商品描述最多 1000 個字"),category:te().required("請選擇商品分類").oneOf(N,"商品分類不存在"),sell:sa().required("請選擇商品狀態")}),b=ia({validationSchema:_,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),g=E("name"),p=E("price"),m=E("description"),y=E("category"),P=E("sell"),v=f([]),H=f([]),A=b.handleSubmit(async o=>{if(v.value[0]?.error){h({text:"圖片檔案無效",snackbarProps:{color:"red"}});return}if(!i.value.id&&v.value.length===0){h({text:"請上傳商品圖片",snackbarProps:{color:"red"}});return}try{const a=new FormData;a.append("name",o.name),a.append("price",o.price),a.append("description",o.description),a.append("category",o.category),a.append("sell",o.sell),v.value.length>0&&a.append("image",v.value[0].file),await(i.value.id?le.update(i.value.id,a):le.create(a)),h({text:"操作成功",snackbarProps:{color:"green"}}),D(),await u()}catch(a){console.log(a);const $=a?.response?.data?.message||"發生錯誤";h({text:$,snackbarProps:{color:"red"}})}});return(o,a)=>{const $=We("vue-file-agent");return ce(),Qe(Q,null,[t(ga,null,{default:s(()=>[t(ca,null,{default:s(()=>[t(ve,{cols:"12"},{default:s(()=>[...a[10]||(a[10]=[w("h1",{class:"text-center"},"商品管理",-1)])]),_:1}),t(ma),t(ve,{cols:"12"},{default:s(()=>[t(va,{"filter-keys":["name","category","description","_id","price","createdAt","updatedAt"],headers:c,items:C.value,search:V.value},{top:s(()=>[t(fa,{class:"px-4"},{default:s(()=>[t(ae,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=l=>V.value=l),density:"compact",flat:"","hide-details":"",placeholder:"搜尋商品","prepend-inner-icon":"mdi-magnify",variant:"outlined"},null,8,["modelValue"]),t(Ze),t(L,{variant:"outlined",onClick:a[1]||(a[1]=l=>S(null))},{default:s(()=>[...a[11]||(a[11]=[W("新增商品",-1)])]),_:1})]),_:1})]),"item.imageUrl":s(({value:l})=>[t(Xe,{src:l,width:"75"},null,8,["src"])]),"item.sell":s(({value:l})=>[l?(ce(),Je(Ye,{key:0,icon:"mdi-check"})):Ke("",!0)]),"item.action":s(({item:l})=>[t(L,{icon:"mdi-pencil",variant:"text",onClick:R=>S(l)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),t(na,{modelValue:i.value.open,"onUpdate:modelValue":a[9]||(a[9]=l=>i.value.open=l),persistent:"",width:"600"},{default:s(()=>[t(da,{disabled:r(b).isSubmitting.value,onSubmit:ea(r(A),["prevent"])},{default:s(()=>[t(aa,null,{default:s(()=>[t(ta,null,{default:s(()=>[W(me(i.value.id?"修改商品":"新增商品"),1)]),_:1}),t(la,null,{default:s(()=>[t(ae,{modelValue:r(g).value.value,"onUpdate:modelValue":a[2]||(a[2]=l=>r(g).value.value=l),"error-messages":r(g).errorMessage.value,label:"商品名稱",maxlength:"100",minlength:"1",required:""},null,8,["modelValue","error-messages"]),t(ae,{modelValue:r(p).value.value,"onUpdate:modelValue":a[3]||(a[3]=l=>r(p).value.value=l),"error-messages":r(p).errorMessage.value,label:"商品價格",min:"0",required:"",type:"number"},null,8,["modelValue","error-messages"]),t(Va,{modelValue:r(y).value.value,"onUpdate:modelValue":a[4]||(a[4]=l=>r(y).value.value=l),"error-messages":r(y).errorMessage.value,items:N,label:"商品分類",required:""},null,8,["modelValue","error-messages"]),t(ha,{modelValue:r(m).value.value,"onUpdate:modelValue":a[5]||(a[5]=l=>r(m).value.value=l),"error-messages":r(m).errorMessage.value,label:"商品說明",maxlength:"1000",rows:"5"},null,8,["modelValue","error-messages"]),t($,{ref_key:"fileAgent",ref:x,modelValue:v.value,"onUpdate:modelValue":a[6]||(a[6]=l=>v.value=l),"raw-model-value":H.value,"onUpdate:rawModelValue":a[7]||(a[7]=l=>H.value=l),accept:"image/png,image/jpg,image/jpeg",compact:!1,deletable:"","max-files":1,"max-size":"1MB",theme:"default"},null,8,["modelValue","raw-model-value"]),t(ba,{modelValue:r(P).value.value,"onUpdate:modelValue":a[8]||(a[8]=l=>r(P).value.value=l),"error-messages":r(P).errorMessage.value,"hide-details":"",label:"上架商品"},null,8,["modelValue","error-messages"])]),_:1}),t(oa,null,{default:s(()=>[t(L,{color:"red",loading:r(b).isSubmitting.value,onClick:D},{default:s(()=>[...a[12]||(a[12]=[W("取消",-1)])]),_:1},8,["loading"]),t(L,{color:"green",loading:r(b).isSubmitting.value,type:"submit"},{default:s(()=>[W(me(i.value.id?"修改":"新增"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof fe=="function"&&fe(ka);export{ka as default};
