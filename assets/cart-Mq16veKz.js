import{ai as x,Z as w,aj as B,v as I,c as m,ak as f,a1 as n,$ as a,S as r,R as V,_ as L,Y as P,a3 as S,am as u,ao as d,aW as U,an as $,ap as v}from"./index-C-Wof5fh.js";import{s as q}from"./order-BVvHKTPk.js";import{V as D,a as _,b as k}from"./route-block-CDH56o19.js";import{V as N}from"./VDivider-DMSXzlXu.js";import{V as R,a as T,b as j,c as A}from"./VList-CXA49yes.js";import{V as E}from"./VNumberInput-BLFc89rT.js";import{V as F}from"./VContainer-Dvv4KtVd.js";import"./ssrBoot-DksyFfg0.js";const O={class:"text-center"},W={__name:"cart",setup(Y){const l=x(),i=w(),b=B(),o=I([]);(async()=>{try{const{data:t}=await v.getCart();o.value=t.result}catch{l({text:"發生錯誤",snackbarProps:{color:"red"}})}})();const g=async(t,s,e)=>{try{const{data:c}=await v.cart({product:s.product._id,quantity:t,replace:!0});i.cart=c.result,t<=0?o.value.splice(e,1):o.value[e].quantity=t}catch{const c=error?.response?.data?.message||"發生錯誤";l({text:c,snackbarProps:{color:"red"}})}},y=m(()=>o.value.reduce((t,s)=>t+s.product.price*s.quantity,0)),C=m(()=>o.value.length===0||o.value.some(t=>!t.product.sell)),h=async()=>{try{const{data:t}=await q.create();i.cart=0,b.push("/orders"),l({text:`結帳成功，訂單 ID: ${t.result._id}`,snackbarProps:{color:"green"}})}catch{const t=error?.response?.data?.message||"發生錯誤";l({text:t,snackbarProps:{color:"red"}})}};return(t,s)=>(n(),f(F,null,{default:a(()=>[r(D,null,{default:a(()=>[r(_,{cols:"12"},{default:a(()=>[...s[0]||(s[0]=[V("h1",{class:"text-center"},"購物車",-1)])]),_:1}),r(N),r(_,{cols:"12"},{default:a(()=>[r(R,{lines:"two"},{default:a(()=>[(n(!0),L(P,null,S(o.value,(e,c)=>(n(),f(T,{key:e._id,active:!e.product.sell,color:"red"},{prepend:a(()=>[r(U,{class:"cursor-pointer",image:e.product.imageUrl,onClick:p=>t.$router.push("/product/"+e.product._id)},null,8,["image","onClick"])]),append:a(()=>[r(E,{"control-variant":"split","hide-details":"",min:0,"model-value":e.quantity,variant:"outlined","onUpdate:modelValue":p=>g(p,e,c)},null,8,["model-value","onUpdate:modelValue"])]),default:a(()=>[r(j,null,{default:a(()=>[u(d(e.product.name),1)]),_:2},1024),r(A,null,{default:a(()=>[u("$"+d(e.product.price),1)]),_:2},1024)]),_:2},1032,["active"]))),128))]),_:1}),V("p",O,"總價: "+d(y.value),1),r($,{color:"green",disabled:C.value,onClick:h},{default:a(()=>[...s[1]||(s[1]=[u("結帳",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}))}};typeof k=="function"&&k(W);export{W as default};
